$$
\newcommand{\red}[1]{{\color{red}{#1}}}
\newcommand{\blue}[1]{{\color{blue}{#1}}}
\newcommand{\span}[1]{\mathrm{span}\left\lbrace{#1}\right\rbrace}
\newcommand{\set}[1]{\left\lbrace{#1}\right\rbrace}
\newcommand{\cspan}[1]{\mathbb C \!-\! \span{#1}}
\newcommand{\sgn}{\mathrm{sgn}}
$$



<h0> 1906.07309 Notes</h0>

# CAR relations

$$
a_ia_j + a_j a_i = 0
$$

$$
a_i^*a_j + a_ja_i^* = \delta_{i,j}
$$

with $i=j$, we have
$$
a_ia_i (= -a_ia_i) = 0 \quad \Rightarrow a_i^*a_i^* = 0
$$

$$
a_i^*a_i = 1-a_ia^*_i
$$



# Matrix Algebra

We write $A=\pmatrix{A_{00} & A_{01}\\A_{10} & A_{11}} \in \mathcal M_2 $. 

>  As a linear space, $\mathcal M_{2^q} = \mathcal M_2\otimes\mathcal M_2 \otimes \cdots \otimes \mathcal M_2$ is generated by $\{E_{mn}^{(q)}\}$ where the superscript $q$ means that this is a $2^q$ by $2^q$ matrix. Naturally, the indices $m,n$ goes from $0$ to $2^q-1$. 
>
> Note that $E^{(q)}_{mn}E^{(q)}_{m'n'} = \delta_{nm'}E^{(q)}_{mn'}$

For $\mathcal M_2$, the matrix units are denoted $\{e_{\alpha\beta}\}\equiv \{E^{(2)}_{mn}\}$. Still, $\alpha, \beta  = 0,1$. 

# Further look in CAR

Define $n_i= a_i^* a_i$. Then $n_i^* = ( a_i^* a_i)^* \substack{\small \text{(the same as hermitian conjugate)}\\=} a_i^* (a_i^*)^* = a_i^* a_i=n_i$

we have $n_i$ is idempotent.
$$
n_in_i =a_i^* a_ia_i^* a_i =a_i^* a_i(1-a_ia^*_i) = a^*_ia_i-a_i^*a_ia_ia_i^* =  a^*_ia_i-a_i^*0a_i^* = a^*_ia_i = n_i
$$
We find that the orthogonal complement of $n_i$ is just $n_i^\bot=a_ia^*_i$, since
$$
n_in_i^\bot=a_i^* a_ia_i a_i^* = a_i^*0 a_i^*  = 0\\
n_i^\bot n_i = a_i a_i^*a_i^* a_i = a_i a_i^*(1-a_i a_i^* ) =(1-a_i^*a_i )-n_i\cdot n_i =  1-2n_i
$$
Still, 
$$
(n_i^\bot)^*=n_i^\bot 
$$

$$
(n^\bot)^2 =a_i^*a_ia_i^*a_i = a_i^*a_i(1-a_ia_i^*) = a_i^*a_i = n^\bot
$$

## Not commuting

Operators from different sites commute, $[a_i,a_j] = 0$, $[a_i,n_j]=0$, but those of the same site don't necessarily commute.
$$
a_in_i - n_ia_i = a_i a_i^* a_i-a_i^* a_i a_i = a_i(1-a_ia_i^*) = a_i\neq 0\\
$$

## Making it work

Define $\tilde v_i=n_i^\bot-n_i$.

We have
$$
\tilde v_i^* = (n_i^\bot-n_i)^* = (n_i^\bot)^*-n_i^* =\tilde v_i
$$

$$
\tilde v_i^2 =(n_i^\bot-n_i)(n_i^\bot-n_i) = (n_i^\bot)^2+n_i^2-n_in_i^\bot-n_i^\bot n_i =n_i^\bot+n_i = 1
$$

Now we have
$$
\tilde v_ia_i =(n_i^\bot-n_i)a_j =(a_i a_i^*-a^*_ia_i)a_j= a_ia_i^*a_i = a_i(1-a_ia^*_i)=a_i
\\
a_i \tilde v_i =a_i(n_i^\bot-n_i) =a_i(a_i a_i^*-a^*_ia_i)= -a_ia_i^*a_i = -a_i(1-a_ia^*_i)=-a_i
\\
\tilde v_ia_i^* =(n_i^\bot-n_i)a_i^* =(a_i a_i^*-a^*_ia_i)a_i^* = a_i(a_i^*)^2-a_i^*a_ia_i^*
\\
a_i^* \tilde v_i =a_i^*(n_i^\bot-n_i) =a_i^*(a_i a_i^*-a^*_ia_i)=a_i^*a_ia_i^*-a_i(a_i^*)^2
$$
Thus
$$
\tilde v_ia_i = - a_i\tilde v_i
$$

$$
\tilde v_ia_i^* = -a_i^*\tilde v_i
$$

or in other words, $\{a_i,\tilde v_i\}=0$, $\{a^*_i,\tilde v_i\}=0$.

Moreover, 
$$
\red{\tilde v_ia_j}a_i \substack{\text{anticommute}\\ \hline \\ \hline\\} -\tilde v_ia_i a_j \substack{\text{$\tilde v_i$'s property}\\ \hline \\ \hline\\} a_i\red{\tilde v_ia_j}
$$
Similarly, 
$$
\red{\tilde v_ia_j}a_i^* \substack{\text{anticommute}\\ \hline \\ \hline\\} -\tilde v_ia_i^* a_j \substack{\text{$\tilde v_i$'s property}\\ \hline \\ \hline\\} a_i^*\red{\tilde v_ia_j}
$$
That means by considering $a_j\rightarrow \tilde v_ia_j$, we made the operators commute. 

## Made it

To make the notation easier and avoid discrepancy of subscripts such as $\tilde v_ia_j$, we introduce
$$
v_i = (n_{i-1}^\bot-n_{i-1})v_{i-1}, \quad v_0 = 1
$$

Or
$$
v_i= \prod_{k=1}^{i-1}(n_k^\bot-n_k), \quad v_0 = 1
$$
It has the properties
$$
v_ia_i = a_iv_i, \quad \text{commuting}\\
v_ia_i^* = a_i^*v_i, \quad \text{commuting}\\
$$

$$
v_ia_iv_ia_i = v_iv_ia_ia_i = 0,\quad \text{nilpotent}
$$

$$
v_ia_i^*v_ia_i^* = v_iv_ia_i^*a_i^* = 0,\quad \text{nilpotent}
$$

$$
v_iv_i =\prod_{k=1}^{i-1}\tilde v_k\prod_{j=1}^{i-1}\tilde v_j = \prod_{k=1}^{i-1}(\tilde v_k)^2 = \prod_{k=1}^{i-1}1 = 1
$$



Of course, $v_i$ communicates with $v_j$ for all $i,j =0,1,2,...,2^q-1$.

Assuming $i\ge j+2$
$$
\begin{align*}
(v_ia_i)(v_ja_j) 
&=\left(\prod_{k=1}^{i-1}(n_k^\bot-n_k) \right)a_i\left(\prod_{l=1}^{j-1}(n_l^\bot-n_l)\right)a_{j} 
\\
&=\left(\prod_{p=j+1}^{i-1}(n_p^\bot-n_p)\right)\left(n_j^\bot-n_j\right)\left(\prod_{k=1}^{j-1}(n_k^\bot-n_k)\right)a_i \left(\prod_{l=1}^{j-1}(n_l^\bot-n_l) \right)a_{j}
\\
&=\left(\prod_{p=j+1}^{i-1}(n_p^\bot-n_p)\right)\red{\tilde v_j}\left(\prod_{k=1}^{j-1}(n_k^\bot-n_k) \right)\red{a_i}\left(\prod_{l=1}^{j-1}(n_l^\bot-n_l) \right)\red{a_{j}}
\\
&=\left(\prod_{k=1}^{j-1}(n_k^\bot-n_k) \right)\red{a_{j}} \left(\prod_{p=j+1}^{i-1}(n_p^\bot-n_p)\right)\red{\tilde v_j}\left(\prod_{l=1}^{j-1}(n_l^\bot-n_l) \right)\red{a_i}\\
&\qquad {\small\text{anticomm. between $a$'s and $va=-av$}}
\\
&=(v_ja_j)(v_ia_i)
\end{align*}
$$
When $i=j+1$, the same argument follows without the extra term of invalid indices range. When $i=j$ $v_ia_i$ naturally commutes with itself. 

Hence, $\{v_ia_i\}$ is a set of operators that commute with each other.

## Sub-algebra

The $C^*$ algebra spanned by $\{v_ia_i\}$ is the same as $\cspan{n_i,n_i^\bot,v_ia_i,v_ia_i^*}$. The latter is linear $\mathbb C$ span.

Notice that $n_i$ and $n_i^\bot$ is idempotent while $v_ia_i$ and $v_ia_i^*$ is nilpotent, 
$$
n_in_i =n_i\\n_i^\bot n_i^\bot = n_i^\bot \\
n_in_i^\bot = 0\\
\\(v_ia_i)(v_ia_i)=0\\(v_ia_i^*)(v_ia_i^*)=0\\
(v_ia_i)(v_ia^*_i) = v_iv_ia_ia^*_i = a_ia_i^* = n_i^\bot\\
(v_ia^*_i)(v_ia_i) = v_iv_ia_i^*a_i = a_i^*a_i = n_i
$$
It's natural to think a map 
$$
e^{(i)}_{11}\substack{?\\=\\\phantom{?}}n_i, \quad 
e^{(i)}_{00}\substack{?\\=\\\phantom{?}}n_i^\bot,\quad 
e^{(i)}_{01}\substack{?\\=\\\phantom{?}}v_ia_i,\quad 
e^{(i)}_{10}\substack{?\\=\\\phantom{?}}v_ia_i^*
$$
Recall that $e$ are just $2$ by $2$ matrices. The superscript $(i)$ indicates the site.

check that
$$
\begin{align}
&n_i(v_ia_i) = v_in_ia_i = v_ia_i^*a_ia_i = 0\\
&(v_ia_i)n_i = v_ia_ia_i^*a_i= v_ia_i(1-a_ia^*_i)=v_ia_i \\
&n_i(v_ia_i^*) = v_in_ia_i^* = v_ia_i^*a_ia^*_i=v_ia_i^*(1-a^*_ia_i)= v_ia_i^*-v_i\cancel{a_i^*a_i^*}a_i=v_ia_i^*\\
&(v_ia_i^*)n_i=v_ia_i^*a_i^*a_i=0\\
&n_i^\bot (v_ia_i) = v_in_i^\bot a_i = v_ia_ia_i^*a_i = v_ia_i (1-a_ia^*_i)=v_ia_i+0=v_ia_i\\
&(v_ia_i)n_i^\bot  = v_i a_ia_ia_i^* = 0\\
&n_i^\bot (v_ia_i^*) = v_in_i^\bot a_i^* = v_ia_ia^*_ia^*_i=0\\
&(v_ia_i^*)n_i^\bot =v_ia_i^*a_ia_i^*=v_ia_i^*(1-a_i^*a_i) = v_ia_i^*
\end{align}
$$
We can confirm that such map 
$$
e^{(i)}_{11}=n_i, \quad 
e^{(i)}_{00}=n_i^\bot,\quad 
e^{(i)}_{01}=v_ia_i,\quad 
e^{(i)}_{10}=v_ia_i^*
$$
does preserve the algebraic relations between the operators.

We can write the above equations in a much simpler form
$$
e_{\alpha\beta}^{(i)}e_{\alpha'\beta'}^{(i)}=\delta_{\beta\alpha'}e_{\alpha\beta'}^{(i)}
$$

## products of generators

Define the operator $E^{(q)}_{\varphi\psi}$, where $\varphi, \psi: \set{0,1,\cdots,q-1}\rightarrow\set{0,1}$ are functions that gives the operator type according on each site (by mapping the site to a tuple $(\varphi(i),\psi(i))\in\set{00,01,10,11}$) .
$$
E_{\varphi\psi}^{(q)}=\prod_{i=0}^{q-1} e^{(i)}_{\varphi(i)\psi(i)} = e^{(0)}_{\varphi(0)\psi(0)}e^{(1)}_{\varphi(1)\psi(1)}\cdots e^{(q-1)}_{\varphi(q-1)\psi(q-1)}
$$
Notice the superscript of RHS goes from $1$ to $q-1$. 

# Code

## binary string

The binary string $\varphi(0)\psi(0)\varphi(1)\psi(1)\cdots\varphi(q-1)\psi(q-1)$ can be interpreted as a binary number $n$ between $0$ and $2^q-1$.
$$
n=\varphi(0)\cdot 2^0 +\varphi(1)\cdot 2^1 +\cdots+ \varphi(q-1)\cdot 2^{q-1}\\
m=\psi(0)\cdot 2^0 +\psi(1)\cdot 2^1 +\cdots+ \psi(q-1)\cdot 2^{q-1}
$$
its digits can be accessed by a function
$$
\mathfrak b_n(i):\set{0,1,\cdots,q-1}\rightarrow \set{0,1}
$$
This way, we can replace functions $\varphi$ and $\psi$ with a integer, 
$$
E_{\varphi\psi}^{(q)}=E_{mn}^{(q)}
$$
and
$$
E_{mn}^{(q)} =\prod_{i=0}^{q-1} e^{(i)}_{\mathfrak b_n(i)\mathfrak b_m(i)} = e^{(0)}_{\mathfrak b_n(0)\mathfrak b_m(0)}e^{(1)}_{\mathfrak b_n(1)\mathfrak b_m(1)}\cdots e^{(q-1)}_{\mathfrak b_n(q-1)\mathfrak b_m(q-1)}
$$
==eq(28) in paper, last term should be $e^{(q-1)}$==.

Computer code:

```fortran
proc=0
bin=0 !(this is {\mathfrak b}_n)
do i=0,Q-1
 bin(i)=mod((n-proc)/2**i,2)
 proc = proc+bin(i)*2**i
end do
```

# Preparation 1: matrices of $a$

Using the above mapping, $e^{(i)}_{01}=v_ia_i$, multiply to the left on both sides $v_i$, we have
$$
\begin{align*}
v_iv_ia_i&=v_ie_{01}^{(i)}\\
a_i&=\prod_{k=0}^{i-1}(n_k^\bot-n_k)e_{01}^{(i)}\\
&=\prod_{k=0}^{i-1}(e^{(k)}_{00}-e^{(k)}_{11})e_{01}^{(i)}\\
&=\prod_{k=0}^{i-1}(e^{(k)}_{00}-e^{(k)}_{11})e_{01}^{(i)}\prod_{j=1}^{q-i}(e^{(j)}_{00}+e^{(j)}_{11})
\end{align*}
$$
The last step we added more terms to make sure that the string of $e$ is of length $q$.

expanding, we have
$$
\begin{align}
a_i&=\prod_{k=0}^{i-1}(e^{(k)}_{00}-e^{(k)}_{11})e_{01}^{(i)}\prod_{j=i+1}^{q-1}(e^{(j)}_{00}+e^{(j)}_{11})\\
&=\sum_{\substack{\text{sequences of }\alpha_i}} \mathrm{signfactor} \cdot \left(e^{(0)}_{\alpha_0\alpha_0}e^{(1)}_{\alpha_1\alpha_1}\cdots e^{(i-1)}_{\alpha_{i-1}\alpha_{i-1}}\right)  e^{(i)}_{01}  \left(e^{(i+1)}_{\alpha_{i+1}\alpha_{i+1}}e^{(i+2)}_{\alpha_{i+2}\alpha_{i+2}}\cdots e^{(q-1)}_{\alpha_{q-1}\alpha_{q-1}}\right)
\end{align}
$$
The sign factor is positive unless there is odd term of $e_{11}^{(k)}$, $ k<i$. Notice that since the $\alpha$'s are either $0$ or $1$, the sign factor is easily obtained as
$$
\begin{align}
a_i
&=\sum_{\text{all sequences of }\alpha_i} (-1)^{\sum_{k=0}^{i-1}\alpha_i} \cdot \left(e^{(0)}_{\alpha_0\alpha_0}e^{(1)}_{\alpha_1\alpha_1}\cdots e^{(i-1)}_{\alpha_{i-1}\alpha_{i-1}}\right)  e^{(i)}_{01}  \left(e^{(i+1)}_{\alpha_{i+1}\alpha_{i+1}}e^{(i+2)}_{\alpha_{i+2}\alpha_{i+2}}\cdots e^{(q-1)}_{\alpha_{q-1}\alpha_{q-1}}\right)
\end{align}
$$
The sum is over sequences of $\alpha$'s. To be more precise, **all possible** sequences of $\alpha$'s, since $0$ and $1$ both appear for each $i$.

The sequence of $\alpha$'s are again represented by a binary number $n$
$$
\set{0,1,\cdots, 2^q-1}\ni n_{\beta_i} = \overline{\alpha_{q-1}\cdots \alpha_{i+1}\beta_i\alpha_{i-1}\cdots\alpha_1\alpha_0}_{\text{binary}}
$$
with $\beta_i$ fixed to be either $1$ or $0$. That makes
$$
n_{0} = \overline{\alpha_{q-1}\cdots \alpha_{i+1}0\alpha_{i-1}\cdots\alpha_1\alpha_0}_{\text{binary}}\\
n_{1} = \overline{\alpha_{q-1}\cdots \alpha_{i+1}1\alpha_{i-1}\cdots\alpha_1\alpha_0}_{\text{binary}}
$$
with 
$$
n_1=n_0+2^i
$$
using the previous section, we have
$$
\begin{align}
a_i
&=\sum_{\text{all sequences of }\alpha_i} (-1)^{\sum_{k=0}^{i-1}\alpha_i} \cdot \left(e^{(0)}_{\alpha_0\alpha_0}e^{(1)}_{\alpha_1\alpha_1}\cdots e^{(i-1)}_{\alpha_{i-1}\alpha_{i-1}}\right)  e^{(i)}_{01}  \left(e^{(i+1)}_{\alpha_{i+1}\alpha_{i+1}}e^{(i+2)}_{\alpha_{i+2}\alpha_{i+2}}\cdots e^{(q-1)}_{\alpha_{q-1}\alpha_{q-1}}\right)\\
&=\sum_{\text{all sequences of }\alpha_i} (-1)^{\sum_{k=0}^{i-1}\alpha_i} \cdot E_{n_0n_1}^{(q)} \\
&=\sum_{n_0=0}^{2^q-1} (-1)^{\sum_{k=0}^{i-1}\mathfrak b_{n_0}(k)} \cdot E_{n_0n_1}^{(q)}\delta_{\mathfrak b_{n_0}(i),0}\\
&=\sum_{n=0}^{2^q-1} (-1)^{\sum_{k=0}^{i-1}\mathfrak b_{n}(k)} \cdot E_{n,n+2^i}^{(q)}\delta_{\mathfrak b_n(i),0}
\end{align}
$$
To change the summation to integer numbers, we need to insert a delta function. Notice that the $i$ in RHS is actually fixed by the LHS index. 

We introduce the following notation,
$$
\mathcal N_i =\sum_{k=0}^{i-1}\mathfrak b_{n}(k)
$$
and notice that naturally we require $b_n(k)=0$, we have for future benefit
$$
\mathcal N_i =\sum_{k=0}^{i}\mathfrak b_{n}(k)
$$
and
$$
a_i
=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i } \cdot E_{n,n+2^i}^{(q)}\delta_{\mathfrak b_n(i),0}
$$
naturally, $a_i^*$ is just with a conjugate.
$$
a_i^*
=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i} E_{n+2^i,n}^{(q)}\delta_{\mathfrak b_n(i),0}
$$

# Preparation 2: Binary Product of $a$

## $aa^*$ and $a^*a$

$$
\begin{align*}
a_i^*a_j &=\left(\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i} E_{n+2^i,n}^{(q)}\delta_{\mathfrak b_n(i),0} \right)\left(\sum_{m=0}^{2^q-1} (-1)^{\mathcal M_j} E_{m,m+2^j}^{(q)}\delta_{\mathfrak b_m(j),0}\right)
\\
&=\sum_{n=0}^{2^q-1}\sum_{m=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal M_j} E_{n+2^i,n}^{(q)} E_{m,m+2^j}^{(q)}\delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_m(j),0}
\\
&=\sum_{n=0}^{2^q-1}\sum_{m=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal M_j} E_{n+2^i,m+2^j}^{(q)} \delta_{mn}\delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_m(j),0}
\\
&=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal N_j} E_{n+2^i,n+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(j),0}
\end{align*}
$$

The sign factor $(-1)^{\mathcal N_i+ \mathcal N_j}$ can be written as (assuming $j>i$)
$$
\begin{align*}
(-1)^{\mathcal N_i+ \mathcal N_j} 
&=(-1)^{\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n}(k)}
\\
&=(-1)^{\sum_{k=i}^{j}\mathfrak b_{n}(k)+2\cdot \sum_{k=0}^{i}\mathfrak b_{n}(k)}
\\
&=(-1)^{\sum_{k=i}^{j}\mathfrak b_{n}(k)}
\end{align*}
$$
<u>Notice that $\mathfrak b_n(i)= \mathfrak b_n(j)  = 0$, the summation can go from $i+1$ to $j-1$ as well.</u>

To make the expression valid for all $i,j$, we write
$$
\begin{align}
a_i^*a_j 
&=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal N_j} E_{n+2^i,n+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(j),0}
\\
&=\sum_{n=0}^{2^q-1} (-1)^{\sum_{k=\min(i,j)}^{\max(i,j)}\mathfrak b_{n}(k)} E_{n+2^i,n+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(j),0}
\end{align}
$$
Notice that the $\delta$'s confine $n$ to a number of form $(45)$. It's equivalent to use a $\delta$ to confine $n'=n+2^i$ to a number of form (45) as well. 

From now on, we will use 
$$
\mathcal N_{ij} =\sum_{k=\min(i,j)}^{\max(i,j)}\mathfrak b_n(k)
$$
due to its popularity.


$$
\begin{align*}
a_i^*a_j 
&=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}} E_{n+2^i,n+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(j),0}
\\
&=\sum_{n'=0}^{2^q-1} (-1)^{\mathcal N_{ij}} E_{n',n'-2^i+2^j}^{(q)} \delta_{\mathfrak b_{n'}(i),\red{1}} \delta_{\mathfrak b_{\red{n'-2^i}}(j),0}
\end{align*}
$$
Since the first delta already made sure that the $i^{\text{th}}$ digit of $n'$ is $1$, then $n'-2^i$ would have exactly the same number on the rest of the digits. Hence, the summation over digits of $n'$ and $n$ in the sign factor does not change. Also, it's safe to write
$$
\begin{align*}
a_i^*a_j 
&=\sum_{n'=0}^{2^q-1} (-1)^{\mathcal N_{ij}} E_{n',n'-2^i+2^j}^{(q)} \delta_{\mathfrak b_{n'}(i),\red{1}} \delta_{\mathfrak b_{\red{n'}}(j),0}
\end{align*}
$$
Using $(3)$ we have
$$
\begin{align}
a_i^*a_j 
&=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}} E_{n,n-2^i+2^j}^{(q)} \delta_{\mathfrak b_{n}(i),\red{1}} \delta_{\mathfrak b_{n}(j),0}
\\
a_ia^*_j & = -a_j^*a_i\notag
\\
&=-\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}} E_{n,n-2^j+2^i}^{(q)} \delta_{\mathfrak b_{n}(j),\red{1}} \delta_{\mathfrak b_{n}(i),0}
\end{align}
$$

## $n$

Moreover, when $i=j$, we have from before
$$
\begin{align}
n_i &= a_i^*a_i \\
&=\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal N_i} E_{n+2^i,n+2^i}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(i),0}
\\
&=\sum_{n=0}^{2^q-1}E_{n+2^i,n+2^i}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_n(i),0}
\end{align}
$$
The same trick on delta we have
$$
\begin{align}
n_i &= a_i^*a_i \\
&=\sum_{n=0}^{2^q-1} E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i),\red{1}} 
\end{align}
$$
The above equation basically says that the $n_i$ is represented by a selected set of matrices  such that $\mathfrak b_n(k)=1$. This will come to handy later when calculating products of $n$.

> Interestingly, from the definition of $E_{mn}$, we have
> $$
> \begin{align}
> E_{nn}^{(q)} &=\prod_{i=0}^{q-1} e^{(i)}_{\mathfrak b_n(i)\mathfrak b_n(i)} 
> \\
> &=\prod_{i=0}^{q-1} e^{(i)}_{\mathfrak b_n(i)\mathfrak b_n(i)}(\delta_{\mathfrak b _n (i),0}+\delta_{\mathfrak b _n (i),1})
> \\
> &=\prod_{i=0}^{q-1} e^{(i)}_{\mathfrak b_n(i)\mathfrak b_n(i)} \delta_{\mathfrak b _n (i),0}\prod_{i=0}^{q-1} e^{(i)}_{\mathfrak b_n(i)\mathfrak b_n(i)}\delta_{\mathfrak b _n (i),1}
> \\
> &=\prod_{i=0}^{q-1} e^{(i)}_{00} \delta_{\mathfrak b _n (i),0}\prod_{i=0}^{q-1} e^{(i)}_{11}\delta_{\mathfrak b _n (i),1}
> \\
> &=\prod_{\mathfrak b_{n}(i)=1} \hat n_i \prod_{\mathfrak b_{n}(j)=0} \hat n_j^\bot
> \end{align}
> $$
> where in the last line, I emphasized that there are two different $n$, one is operator, the other is integer.



Similarly, for $n_i^\bot$, we have $n_i+n_i^\bot =1$
$$
\begin{align*}
n_i^\bot &=1-n_i
\\
&=\sum_{n=0}^{2^q-1} E_{n,n}^{(q)}-\sum_{n=0}^{2^q-1} E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i),\red{1}} 
\\
&=\sum_{n=0}^{2^q-1} E_{n,n}^{(q)}(\delta_{\mathfrak b_{n}(i),\red{1}} +\delta_{\mathfrak b_{n}(i),\red{0}} )-\sum_{n=0}^{2^q-1} E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i),\red{1}} 
\\
&=\sum_{n=0}^{2^q-1} E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i),\red{0}} 
\end{align*}
$$

## $aa$ and $a^*a^*$

Further we have
$$
\begin{align*}
a_ia_j &=\left(\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_i} E_{n,n+2^i}^{(q)}\delta_{\mathfrak b_n(i),0} \right)\left(\sum_{m=0}^{2^q-1} (-1)^{\mathcal M_j} E_{m,m+2^j}^{(q)}\delta_{\mathfrak b_m(j),0}\right)
\\
&=\sum_{n=0}^{2^q-1}\sum_{m=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal M_j} E_{n,n+2^i}^{(q)} E_{m,m+2^j}^{(q)}\delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_m(j),0}
\\
&=\sum_{n=0}^{2^q-1}\sum_{m=0}^{2^q-1} (-1)^{\mathcal N_i+ \mathcal M_j} E_{n,m+2^j}^{(q)} \delta_{n+2^i,m}\delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_m(j),0}
\\
&=\sum_{n=0}^{2^q-1} (-1)^{\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n+2^i}(k)}E_{n,n+2^i+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n+2^i}(j),0}
\\
&=\sum_{n=0}^{2^q-1} (-1)^{\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n+2^i}(k)}E_{n,n+2^i+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}
\end{align*}
$$
of course when $i=j$, $a_ia_j = 0$. when $i\neq j$, we know from before that the $i$ th digit is zero, so $\delta_{\mathfrak b_{n+2^i}(j),0}=\delta_{\mathfrak b_{n}(j),0}$, and note again, $\mathfrak b_n(i)=0$ so we have the freedom of adding or removing the $i$ th term in summation.
$$
\begin{align}
\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n+2^i}(k) 
&= 
\begin{cases}
\displaystyle
\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n}(k)+1, \quad j>i \\
\displaystyle
\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=0}^{j}\mathfrak b_{n}(k), \quad j<i
\end{cases}
\\
&=
\begin{cases}
\displaystyle
2\cdot\sum_{k=0}^{i}\mathfrak b_{n}(k)+\sum_{k=i}^{j}\mathfrak b_{n}(k)+1, \quad j>i \\
\displaystyle
2\cdot\sum_{k=0}^{j}\mathfrak b_{n}(k)+\sum_{k=j}^{i}\mathfrak b_{n}(k),\quad j<i
\end{cases}
\end{align}
$$
the extra $+1$ will result in a minus sign factor. These cases (even when $i=j$) can be included in a single expression using $\sgn$ 
$$
a_ia_j =\sgn(i-j)\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}}E_{n,n+2^i+2^j}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}
$$
The $a^*_ia^*_j$ is just conjugate of $a_ia_j$,
$$
\begin{align}
a_i^*a_j^* &= (a_ja_i)^*
\\
&=\sgn(j-i)\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}}E_{n+2^i+2^j,n}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}
\end{align}
$$

# Preparation 3: quadruple product and beyond

## Products of $n$

Now it's easy to write down
$$
\begin{align}
n_{i_1} n_{i_2}\cdots n_{i_k}&=\prod_{s=1}^k n_{i_s}
\\
&=\prod_{s=1}^k\left(\sum_{n=0}^{2^q-1} E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i_s),1} \right)
\end{align}
$$
Notice that $E_{n,n}^{(q)}$'s are idempotent, and different $E_{n,n}^{(q)}$ are orthogonal. All the remaining term of the product is just those of the same $n$, any other terms are $0$. The product originally contains $(2^q)^k$ terms, now contains only $2^q$ terms. each term is just a product of $E_{n,n}^{(q)} \delta_{\mathfrak b_{n}(i_s),1}$ with different $s$. 

We have
$$
\begin{align}
n_{i_1} n_{i_2}\cdots n_{i_k}
&=\sum_{n=0}^{2^q-1}\left( E_{n,n}^{(q)} \prod_{s=1}^k\delta_{\mathfrak b_{n}(i_s),1}\right)
\end{align}
$$
In the same spirit, we have
$$
n_{i_1}^\bot n_{i_2}^\bot \cdots n_{i_k}^\bot =\sum_{n=0}^{2^q-1}\left( E_{n,n}^{(q)} \prod_{s=1}^k\delta_{\mathfrak b_{n}(i_s),0}\right)
$$

## products of $a$

$$
\begin{align}
a_i^*a_j^*a_ka_l
&=\left(\sgn(j-i)\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}}E_{n+2^i+2^j,n}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}\right)\\
&\phantom{==}\cdot\left(\sgn(k-l)\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{kl}}E_{n,n+2^k+2^l}^{(q)} \delta_{\mathfrak b_n(k),0} \delta_{\mathfrak b_{n}(l),0}\right)
\\
&=\left(\sgn[(j-i)(k-l)]\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}+\mathcal N_{kl}} E_{n+2^i+2^j,n}^{(q)}E_{n,n+2^k+2^l}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}\delta_{\mathfrak b_n(k),0} \delta_{\mathfrak b_{n}(l),0}\right)
\end{align}
$$

again, the only nonzero terms are those products of $E$ of matching indices. we have

$$
\begin{align}
a_i^*a_j^*a_ka_l
&=\left(\sgn[(j-i)(k-l)]\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}+\mathcal N_{kl}} E_{n+2^i+2^j,n+2^k+2^l}^{(q)} \delta_{\mathfrak b_n(i),0} \delta_{\mathfrak b_{n}(j),0}\delta_{\mathfrak b_n(k),0} \delta_{\mathfrak b_{n}(l),0}\right)
\end{align}
$$

To shift the indices of $E$ so the first index is $n$, we play the same trick as before, noting that $i,j,k,l$ are all different.
$$
\begin{align}
a_i^*a_j^*a_ka_l
&=\left(\sgn[(j-i)(k-l)]\sum_{n'=0}^{2^q-1} (-1)^{\mathcal N_{ij}+\mathcal N_{kl}} E_{n',n'-2^i-2^j+2^k+2^l}^{(q)} \\
\delta_{\mathfrak b_{n'-2^i-2^j}(i),0} 
\delta_{\mathfrak b_{n'-2^i-2^j}(j),0}\delta_{\mathfrak b_{n'-2^i-2^j}(k),0} \delta_{\mathfrak b_{n'-2^i-2^j}(l),0}\right)
\\
&=\sgn[(j-i)(k-l)]\sum_{n=0}^{2^q-1} (-1)^{\mathcal N_{ij}+\mathcal N_{kl}} E_{n',n-2^i-2^j+2^k+2^l}^{(q)}
\delta_{\mathfrak b_{n}(i),1} 
\delta_{\mathfrak b_{n}(j),1}\delta_{\mathfrak b_{n}(k),0} \delta_{\mathfrak b_{n}(l),0}\\

\end{align}
$$

# $N$ particle sectors

The particle number operator 
$$
\hat N = \sum_{i=0}^{q-1} n_i = \sum_{i=0}^{q-1} e_{11}^{(i)}
$$
We notice 
$$
\hat N E_{n,n}^{(q)} =\sum_{i=0}^{q-1} n_k\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
$$
since $n_i$ is idempotent, we have
$$
\begin{align}
\hat N E_{n,n}^{(q)} &=\sum_{k=0}^{q-1} n_k\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=\left(\sum_{k=0}^{q-1} n_k (\delta_{\mathfrak b_n(k),0}+\delta_{\mathfrak b_n(k), 1}) \right)\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=\cancel{\sum_{k=0}^{q-1} n_k \delta_{\mathfrak b_n(k),0}\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot}
+
\sum_{k=0}^{q-1} n_k \delta_{\mathfrak b_n(k), 1} \prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=
\sum_{k=0}^{q-1} n_k \delta_{\mathfrak b_n(k), 1} \prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\end{align}
$$
Inside the summation, each term contains a $n_k$ which can be absorbed into the first product by shuffling the $n_i$'s since they all commute. Hence we have
$$
\begin{align}
\hat N E_{n,n}^{(q)} &=
\sum_{k=0}^{q-1}  \delta_{\mathfrak b_n(k), 1} \prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=\left(\sum_{k=0}^{q-1}  \delta_{\mathfrak b_n(k), 1} \right)\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=\left(\sum_{k=0}^{q-1}  \mathfrak b_n(k) \right)\prod_{\mathfrak b_{n}(i)=1}  n_i \prod_{\mathfrak b_{n}(j)=0} n_j^\bot
\\
&=\left(\sum_{k=0}^{q-1}  \mathfrak b_n(k) \right) E_{n,n}^{(q)}
\end{align}
$$
The same steps leads us to the following identity
$$
\hat N E_{n,n}^{(q)} =E_{n,n}^{(q)}\hat N =\left(\sum_{k=0}^{q-1}  \mathfrak b_n(k) \right) E_{n,n}^{(q)}
$$

Notice that $\sum_{k=0}^{q-1}  \mathfrak b_n(k) $ is the number of $n_i$ appeared in $E_{n,n}$. Hence the number of particles associated with such $E_n$ is just

==why?==
$$
\mathcal N(n) =  \sum_{k=0}^{q-1}  \mathfrak b_n(k) 
$$
The Hamiltonian doesn't always preserves the particle number, hence our number operator could have multiple eigenvalues. The eigenvalues of the total particle number operator can range from $0$ to $q-1$ (for fermions). Hence we can decompose the number operator into different sectors as

$$
\hat N = \sum_{N=0}^{q-1}N \left( \sum_{n=0}^{2^q-1} \delta_{\mathcal N(n),N} E_{n,n}^{(q)}\right)
$$

## Meaning of $N$ sectors

when $Q=4$, there should be 

$1111, 1120,1201,1210,2011,2101,2110,2002,2020,2200,0202,0220$

12 configurations